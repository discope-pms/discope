<?php
/*
    This file is part of Symbiose Community Edition <https://github.com/yesbabylon/symbiose>
    Some Rights Reserved, Yesbabylon SRL, 2020-2024
    Licensed under GNU AGPL 3 license <http://www.gnu.org/licenses/>
*/
namespace sale\booking;
use equal\orm\Model;

class GuestListItem extends Model {

    public static function getColumns() {
        return [

            'firstname' => [
                'type'              => 'string',
                'description'       => "First name of the guest."
            ],

            'lastname' => [
                'type'              => 'string',
                'description'       => 'Last name of the guest.'
            ],

            'gender' => [
                'type'              => 'string',
                'selection'         => ['M' => 'Male', 'F' => 'Female', 'X' => 'Non-binary'],
                'description'       => 'Reference guest gender.'
            ],

            'date_of_birth' => [
                'type'              => 'date',
                'description'       => 'Date of birth of the guest.'
            ],

            'citizen_identification' => [
                'type'              => 'string',
                'description'       => 'Citizen registration number, if any.',
                'visible'           => ["address_country", "=", "BE"]
            ],

            'is_coordinator' => [
                'type'              => 'boolean',
                'description'       => 'The guest is the coordinator',
                'default'           => false
            ],

            'guest_list_id' => [
                'type'              => 'many2one',
                'foreign_object'    => 'sale\booking\GuestList',
                'description'       => 'Guest List associated to guest item.',
                'required'          => true,
                'ondelete'          => 'cascade',
                'onupdate'          => 'onupdateGuestListId'
            ],

            'booking_id' => [
                'type'              => 'many2one',
                'foreign_object'    => 'sale\booking\Booking',
                'description'       => 'The booking the guest list item relates to.'
            ],

            'booking_line_group_id' => [
                'type'              => 'many2one',
                'foreign_object'    => 'sale\booking\BookingLineGroup',
                'description'       => 'Group the line relates to guest list item.'
            ],

            'address_street' => [
                'type'              => 'string',
                'description'       => 'Street and number for the address of the guest.'
            ],

            'address_zip' => [
                'type'              => 'string',
                'description'       => 'Postal code for the address of the guest"'
            ],

            'address_city' => [
                'type'              => 'string',
                'description'       => 'City for the address of the guest".'
            ],

            'address_country' => [
                'type'              => 'string',
                'usage'             => 'country/iso-3166:2',
                'description'       => 'Country of the guest.',
                'default'           => 'BE',
                'selection'         => [
                    'AF'    => 'Afghanistan',
                    'AX'    => 'Aland Islands',
                    'AL'    => 'Albanie',
                    'DZ'    => 'Algérie',
                    'AS'    => 'American Samoa',
                    'AD'    => 'Andorra',
                    'AO'    => 'Angola',
                    'AI'    => 'Anguilla',
                    'AQ'    => 'Antarctica',
                    'AG'    => 'Antigua And Barbuda',
                    'AR'    => 'Argentina',
                    'AM'    => 'Arménie',
                    'AW'    => 'Aruba',
                    'AU'    => 'Australia',
                    'AT'    => 'Autriche',
                    'AZ'    => 'Azerbaïdjan',
                    'BS'    => 'Bahamas',
                    'BH'    => 'Bahrain',
                    'BD'    => 'Bangladesh',
                    'BB'    => 'Barbados',
                    'BY'    => 'Biélorussie',
                    'BE'    => 'Belgique',
                    'BZ'    => 'Belize',
                    'BJ'    => 'Benin',
                    'BM'    => 'Bermuda',
                    'BT'    => 'Bhutan',
                    'BO'    => 'Bolivia',
                    'BA'    => 'Bosnie-Herzégovine',
                    'BW'    => 'Botswana',
                    'BV'    => 'Bouvet Island',
                    'BR'    => 'Brazil',
                    'IO'    => 'British Indian Ocean Territory',
                    'BN'    => 'Brunei Darussalam',
                    'BG'    => 'Bulgarie',
                    'BF'    => 'Burkina Faso',
                    'BI'    => 'Burundi',
                    'KH'    => 'Cambodia',
                    'CM'    => 'Cameroon',
                    'CA'    => 'Canada',
                    'CV'    => 'Cape Verde',
                    'KY'    => 'Cayman Islands',
                    'CF'    => 'Central African Republic',
                    'TD'    => 'Chad',
                    'CL'    => 'Chile',
                    'CN'    => 'China',
                    'CX'    => 'Christmas Island',
                    'CC'    => 'Cocos (Keeling) Islands',
                    'CO'    => 'Colombia',
                    'KM'    => 'Comoros',
                    'CG'    => 'Congo',
                    'CD'    => 'Congo, Democratic Republic',
                    'CK'    => 'Cook Islands',
                    'CR'    => 'Costa Rica',
                    'CI'    => 'Cote D\'Ivoire',
                    'HR'    => 'Croatie',
                    'CU'    => 'Cuba',
                    'CY'    => 'Chypre',
                    'CZ'    => 'Tchéquie',
                    'DK'    => 'Danemark',
                    'DJ'    => 'Djibouti',
                    'DM'    => 'Dominica',
                    'DO'    => 'Dominican Republic',
                    'EC'    => 'Ecuador',
                    'EG'    => 'Egypte',
                    'SV'    => 'El Salvador',
                    'GQ'    => 'Equatorial Guinea',
                    'ER'    => 'Eritrea',
                    'EE'    => 'Estonie',
                    'ET'    => 'Ethiopia',
                    'FK'    => 'Falkland Islands (Malvinas)',
                    'FO'    => 'Faroe Islands',
                    'FJ'    => 'Fiji',
                    'FI'    => 'Finlande',
                    'FR'    => 'France',
                    'GF'    => 'French Guiana',
                    'PF'    => 'French Polynesia',
                    'TF'    => 'French Southern Territories',
                    'GA'    => 'Gabon',
                    'GM'    => 'Gambia',
                    'GE'    => 'Géorgie',
                    'DE'    => 'Allemagne',
                    'GH'    => 'Ghana',
                    'GI'    => 'Gibraltar',
                    'GR'    => 'Greece',
                    'GL'    => 'Greenland',
                    'GD'    => 'Grenada',
                    'GP'    => 'Guadeloupe',
                    'GU'    => 'Guam',
                    'GT'    => 'Guatemala',
                    'GG'    => 'Guernsey',
                    'GN'    => 'Guinea',
                    'GW'    => 'Guinea-Bissau',
                    'GY'    => 'Guyana',
                    'HT'    => 'Haiti',
                    'HM'    => 'Heard Island & Mcdonald Islands',
                    'VA'    => 'Holy See (Vatican City State)',
                    'HN'    => 'Honduras',
                    'HK'    => 'Hong Kong',
                    'HU'    => 'Hongrie',
                    'IS'    => 'Islande',
                    'IN'    => 'India',
                    'ID'    => 'Indonesia',
                    'IR'    => 'Iran, Islamic Republic Of',
                    'IQ'    => 'Iraq',
                    'IE'    => 'Irlande',
                    'IM'    => 'Isle Of Man',
                    'IL'    => 'Israel',
                    'IT'    => 'Italie',
                    'JM'    => 'Jamaica',
                    'JP'    => 'Japan',
                    'JE'    => 'Jersey',
                    'JO'    => 'Jordanie',
                    'KZ'    => 'Kazakhstan',
                    'KE'    => 'Kenya',
                    'KI'    => 'Kiribati',
                    'KR'    => 'Korea',
                    'KW'    => 'Kuwait',
                    'KG'    => 'Kyrgyzstan',
                    'LA'    => 'Lao People\'s Democratic Republic',
                    'LV'    => 'Lettonie',
                    'LB'    => 'Liban',
                    'LS'    => 'Lesotho',
                    'LR'    => 'Liberia',
                    'LY'    => 'Libye',
                    'LI'    => 'Liechtenstein',
                    'LT'    => 'Lituanie',
                    'LU'    => 'Luxembourg',
                    'MO'    => 'Macao',
                    'MK'    => 'Macedonia',
                    'MG'    => 'Madagascar',
                    'MW'    => 'Malawi',
                    'MY'    => 'Malaysia',
                    'MV'    => 'Maldives',
                    'ML'    => 'Mali',
                    'MT'    => 'Malta',
                    'MH'    => 'Marshall Islands',
                    'MQ'    => 'Martinique',
                    'MR'    => 'Mauritania',
                    'MU'    => 'Mauritius',
                    'YT'    => 'Mayotte',
                    'MX'    => 'Mexico',
                    'FM'    => 'Micronesia, Federated States Of',
                    'MD'    => 'Moldavie',
                    'MC'    => 'Monaco',
                    'MN'    => 'Mongolia',
                    'ME'    => 'Monténégro',
                    'MS'    => 'Montserrat',
                    'MA'    => 'Maroc',
                    'MZ'    => 'Mozambique',
                    'MM'    => 'Myanmar',
                    'NA'    => 'Namibia',
                    'NR'    => 'Nauru',
                    'NP'    => 'Nepal',
                    'NL'    => 'Pays-Bas',
                    'AN'    => 'Netherlands Antilles',
                    'NC'    => 'New Caledonia',
                    'NZ'    => 'New Zealand',
                    'NI'    => 'Nicaragua',
                    'NE'    => 'Niger',
                    'NG'    => 'Nigeria',
                    'NU'    => 'Niue',
                    'NF'    => 'Norfolk Island',
                    'MP'    => 'Northern Mariana Islands',
                    'NO'    => 'Norvège',
                    'OM'    => 'Oman',
                    'PK'    => 'Pakistan',
                    'PW'    => 'Palau',
                    'PS'    => 'Palestinian Territory, Occupied',
                    'PA'    => 'Panama',
                    'PG'    => 'Papua New Guinea',
                    'PY'    => 'Paraguay',
                    'PE'    => 'Peru',
                    'PH'    => 'Philippines',
                    'PN'    => 'Pitcairn',
                    'PL'    => 'Pologne',
                    'PT'    => 'Portugal',
                    'PR'    => 'Puerto Rico',
                    'QA'    => 'Qatar',
                    'RE'    => 'Reunion',
                    'RO'    => 'Roumanie',
                    'RU'    => 'Russie',
                    'RW'    => 'Rwanda',
                    'BL'    => 'Saint Barthelemy',
                    'SH'    => 'Saint Helena',
                    'KN'    => 'Saint Kitts And Nevis',
                    'LC'    => 'Saint Lucia',
                    'MF'    => 'Saint Martin',
                    'PM'    => 'Saint Pierre And Miquelon',
                    'VC'    => 'Saint Vincent And Grenadines',
                    'WS'    => 'Samoa',
                    'SM'    => 'San Marino',
                    'ST'    => 'Sao Tome And Principe',
                    'SA'    => 'Saudi Arabia',
                    'SN'    => 'Senegal',
                    'RS'    => 'Serbie',
                    'SC'    => 'Seychelles',
                    'SL'    => 'Sierra Leone',
                    'SG'    => 'Singapore',
                    'SK'    => 'Slovakia',
                    'SI'    => 'Slovénie',
                    'SB'    => 'Solomon Islands',
                    'SO'    => 'Somalia',
                    'ZA'    => 'South Africa',
                    'GS'    => 'South Georgia And Sandwich Isl.',
                    'ES'    => 'Espagne',
                    'LK'    => 'Sri Lanka',
                    'SD'    => 'Sudan',
                    'SR'    => 'Suriname',
                    'SJ'    => 'Svalbard And Jan Mayen',
                    'SZ'    => 'Swaziland',
                    'SE'    => 'Suède',
                    'CH'    => 'Suisse',
                    'SY'    => 'Syrie',
                    'TW'    => 'Taiwan',
                    'TJ'    => 'Tajikistan',
                    'TZ'    => 'Tanzania',
                    'TH'    => 'Thailand',
                    'TL'    => 'Timor-Leste',
                    'TG'    => 'Togo',
                    'TK'    => 'Tokelau',
                    'TO'    => 'Tonga',
                    'TT'    => 'Trinidad And Tobago',
                    'TN'    => 'Tunisie',
                    'TR'    => 'Turquie',
                    'TM'    => 'Turkmenistan',
                    'TC'    => 'Turks And Caicos Islands',
                    'TV'    => 'Tuvalu',
                    'UG'    => 'Uganda',
                    'UA'    => 'Ukraine',
                    'AE'    => 'United Arab Emirates',
                    'GB'    => 'United Kingdom',
                    'US'    => 'United States',
                    'UM'    => 'United States Outlying Islands',
                    'UY'    => 'Uruguay',
                    'UZ'    => 'Uzbekistan',
                    'VU'    => 'Vanuatu',
                    'VE'    => 'Venezuela',
                    'VN'    => 'Viet Nam',
                    'VG'    => 'Virgin Islands, British',
                    'VI'    => 'Virgin Islands, U.S.',
                    'WF'    => 'Wallis And Futuna',
                    'EH'    => 'Western Sahara',
                    'YE'    => 'Yemen',
                    'ZM'    => 'Zambia',
                    'ZW'    => 'Zimbabwe'
                ],
            ]

        ];
    }

    public static function onupdateGuestListId($om, $oids, $values, $lang) {
        $lines = $om->read(self::getType(), $oids, ['guest_list_id.booking_id'], $lang);
        foreach($lines as $lid => $line) {
            $om->update(self::getType(), $lid, ['booking_id' => $line['guest_list_id.booking_id']]);
        }
    }
}
